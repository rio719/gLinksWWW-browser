<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gLinksWWW Account Manager</title>
    <style>
         /* í´ë˜ì‹ ìœˆë„ìš° ìŠ¤íƒ€ì¼ */
     body {
            background-color: #c0c0c0; /* í´ë˜ì‹ ìœˆë„ìš° íšŒìƒ‰ */
            font-family: 'Tahoma', 'Arial', sans-serif;
            font-size: 12px;
            padding: 20px;
        }
        h2 {
            color: #000080;
            border-bottom: 2px solid #808080;
            padding-bottom: 5px;
            margin-top: 0;
        }
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background-color: white;
            box-shadow: inset 2px 2px #808080, inset -2px -2px #ffffff;
        }
        th {
            background-color: #d4d0c8;
            border: 1px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            padding: 6px;
            text-shadow: 1px 1px white;
        }
        td {
            padding: 6px;
            border: 1px solid #eeeeee;
        }
        tr:nth-child(even) { background-color: #f9f9f9; }
        
        /* í´ë˜ì‹ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button {
            padding: 4px 12px;
            background-color: #d4d0c8;
            border: 2px outset #ffffff;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 1px 1px 0px black;
        }
        button:active {
            border: 2px inset #ffffff;
            box-shadow: none;
        }
        button.delete-btn {
            color: #a00000;
        }
         button.nuclear-btn {
            color: #c4b702;
        }
        .vault-container {
            border: 2px inset #ffffff;
            padding: 10px;
            background: #e0e0e0;
        }
        </style>
</head>
<body>
    
        <h2>gLinksWWW Account Manager</h2>
    <div class="vault-container">
        <button onclick="addAccount('google')" style="color:blue">+ Add Google</button>
        
        <table>
            <thead>
                <tr>
                    <th><strong>Account</strong></th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="TableBody">
                </tbody>
        </table>
    </div>
    <script>
    const { ipcRenderer } = require('electron');

 // account.htmlì˜ <script> íƒœê·¸ ì•ˆì— ì¶”ê°€
ipcRenderer.on('accounts-updated', () => {
    console.log("ê³„ì • ëª©ë¡ ê°±ì‹  ì‹ í˜¸ ìˆ˜ì‹ ");
    refreshList(); // ì´ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì–´ì•¼ í…Œì´ë¸”ì´ ë‹¤ì‹œ ê·¸ë ¤ì§‘ë‹ˆë‹¤.
});

// ì¶”ê°€ë¡œ í…Œì´ë¸” ë°”ë””ë¥¼ ê·¸ë¦¬ëŠ” í•¨ìˆ˜ì—ì„œ ì—ëŸ¬ ë°©ì§€
async function refreshList() {
    const accounts = await ipcRenderer.invoke('get-accounts');
    const container = document.getElementById('TableBody');
    if (!container) return; // ì—ëŸ¬ ë°©ì§€
    
    // ì´ ë¶€ë¶„ì— ìˆ«ìë¥¼ í‘œì‹œí•˜ëŠ” ì—˜ë¦¬ë¨¼íŠ¸ê°€ ì—†ë‹¤ë©´ ì—ëŸ¬ê°€ ë‚˜ë‹ˆ ì¡°ê±´ë¬¸ ì¶”ê°€
    const countEl = document.getElementById('count');
    if (countEl) countEl.innerText = accounts.length;

    container.innerHTML = accounts.map((acc, i) => `
        <tr>
            <td><strong>[${acc.provider}]</strong> ${acc.email}</td>
            <td><button onclick="delAcc(${i})" class="delete-btn">Delete</button><button onclick="loginWithAccount(${i})">Login</button></td>
        </tr>
    `).join('');
}

    async function delAcc(index) {
        if(confirm("are you sure to delete this account?")) {
            await ipcRenderer.invoke('delete-account', index);
            refreshList();
        }
    }
    async function addAccount(provider) {
            const accounts = await ipcRenderer.invoke('get-accounts');
            if (accounts.length >= 10) {
                alert("maximum 10 accounts allowed.");
                return;
            }
            // ì‹¤ì œ ì¸ì¦ ë¡œì§ (ì—¬ê¸°ì„œëŠ” ì˜ˆì‹œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ì§€ë§Œ, ë‚˜ì¤‘ì—ëŠ” Supabase ì¸ì¦ ê²°ê³¼ê°’ì„ ë³´ëƒ…ë‹ˆë‹¤)
            ipcRenderer.send('start-oauth', provider);
        }
async function loginWithAccount(index) {
    const result = await ipcRenderer.invoke('login-with-account', index);
    if (result) {
        // ğŸ”¥ ëª¨ë“  êµ¬ê¸€ ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸!
        const sites = [
            'https://mail.google.com',
            'https://youtube.com', 
            'https://myaccount.google.com',
            'https://drive.google.com',
            'https://photos.google.com'
        ];
        
        sites.forEach(site => {
            setTimeout(() => window.open(site, '_blank'), Math.random() * 500);
        });
        
        alert(`Logged in successfully! ${successCount}/${account.cookies.length} cookies restored. opening google services...`);
    }
}

    refreshList();

</script>
</body>
</html>